<div class="d-flex flex-column flex-md-row justify-content-start">
  <%= link_to new_sale_path, {class: "btn btn-info mb-2 mb-md-0 mr-md-2", id: "crear-venta-btn"}  do %>
    <span class="fas fa-plus-square"> </span>
    Realizar venta
  <%end%>
  <button type="button" class="btn btn-info mb-2 mb-md-0 mr-md-2" data-toggle="modal" data-target="#saleSearchModal">
    <span class="fa fa-search"> </span>
    Buscar venta
  </button>
  <% if params[:id] %>
    <%= link_to sales_path, { type:"button", class: 'btn btn-secondary mb-2 mb-md-0 mr-md-2' } do %>
      <span class="fa fa-arrow-left"></span>
      Volver atrás
    <% end %>
  <% end %>
</div>
<br />
<div class="card shadow mb-4">
  <div class="card-body">
    <div class="table-responsive">
      <table class="table table-bordered" id="tabla_ventas" width="60%" cellspacing="0">
        <thead>
          <tr>
            <th>Id</th>
            <th>Vendedor</th>
            <th>Cliente</th>
            <th>Importe</th>
            <th>ESTADO</th>
            <th>Acciones: </th>
          </tr>
        </thead>
        <tbody>
          <% if @sales.empty? %>
            <tr>
              <td> No hay ventas </td>
              <td></td>
              <td></td>
            </tr>
          <% else %>
            <% @sales.each do |venta| %>
              <tr>
                <td> <%= venta.id %> </td>
                <td> <%= venta.user.email %> </td>
                <td> <%= venta.try(:client).try(:name) %> </td>
                <td> <%= venta.total_amount %> </td>
                <td>
                  <% if venta.paid?() %>
                    <div class="alert alert-success" role="alert">
                      <i class="fas fa-check"></i>
                      COBRADA
                    </div>
                  <% elsif venta.pending_amount() < venta.total_amount %>
                    <div class="alert alert-warning" role="alert">
                      <i class="fas fa-clock"></i>
                      PARCIALMENTE COBRADA, FALTA: $<%= venta.total_amount - venta.total_paid() %>
                    </div>
                  <% else %>
                    <div class="alert alert-danger" role="alert">
                      <i class="fas fa-exclamation-triangle"></i>
                      PENDIENTE DE COBRO
                    </div>
                  <% end %>
                </td>
                <td>
                  <div class="btn-group" role="group">
                    <% if not venta.paid?() %>
                      <!-- Button trigger modal -->
                      <button type="button" class="btn btn-warning mb-2 mb-md-0 mr-md-2" data-bs-toggle="modal" data-bs-target="#registerPayment" data-sale-id="<%= venta.id %>">
                        <i class="fas fa-file-invoice-dollar"></i>
                        Registrar Cobro
                      </button>
                    <% end %>
                    <%= link_to sale_path(venta), {class: "btn btn-info mb-2 mb-md-0 mr-md-2", remote: true} do%>
                      <i class="fas fa-info-circle"></i>
                      Detalles
                    <% end %>
                    <%= link_to receipt_sale_path(venta), class: "btn btn-success mb-2 mb-md-0 mr-md-2" do %>
                      <span class="fa fa-download"> </span>
                      Comprobante
                    <% end %>
                    <%= link_to sale_path(venta), method: :delete, data: { confirm: '¿Eliminar la venta?' }, class: "btn btn-danger mb-2 mb-md-0 mr-md-2" do %>
                      <i class="fas fa-trash-alt"></i>
                      Borrar
                    <% end %>
                  </div>
                </td>
              </tr>
            <% end %>
          <% end %>
        </tbody>
      </table>
      <nav aria-label="...">
        <ul class="pagination">
          <li class="page-item <%= 'disabled' if @sales.current_page == 1 %>">
            <%= link_to 'Atrás', url_for(page: @sales.current_page - 1), class: 'page-link' %>
          </li>
          <% @sales.total_pages.times do |i| %>
            <li class="page-item <%= 'active' if @sales.current_page == i + 1 %>" aria-current="page">
              <%= link_to i + 1, url_for(page: i + 1), class: 'page-link' %>
            </li>
          <% end %>
          <li class="page-item <%= 'disabled' if @sales.current_page == @sales.total_pages %>">
            <%= link_to 'Siguiente', url_for(page: @sales.current_page + 1), class: 'page-link' %>
          </li>
        </ul>
      </nav>
    </div>
  </div>
</div>
<%= render 'modal_sales' %>
<%= render 'modal_sale_search' %>
<%= render 'modal_register_payment' %>
